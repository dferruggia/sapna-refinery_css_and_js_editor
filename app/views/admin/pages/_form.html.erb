<% url_opts = action_name == 'edit' ? {:url => admin_page_path(@page.id)} : {} %>
<%= javascript_include_tag "jquery.min", "jquery-ui-1.8.9.custom.min", "rails" %>
<%= javascript_include_tag "nested_form"%>
<%= nested_form_for [:admin, @page], url_opts do |f| %>

  <%= render :partial => "/shared/admin/error_messages",
             :locals => {
               :object => @page,
               :include_object_name => true
             } %>

  <%= render :partial => "locale_picker",
             :locals => {
               :current_locale => Thread.current[:globalize_locale]
             } if defined?(::Refinery::I18n) %>

  <div class="field">
    <%= f.label :title %>
    <%= f.text_field :title, :class => "larger widest" %>
  </div>

  <%= render :partial => "form_fields_after_title",
             :locals => {
               :f => f
             } %>

  <div class='field'>
    <%= render :partial => "form_page_parts",
               :locals => {
                 :f => f
               } %>
  </div>
	<div class="field">
    <%= f.label :is_partial %>
    <%= f.check_box :is_partial %>
  </div>
	<div class='field'>
		<%= f.label :page_partials %>
		<%# @page.page_partials.build if @page.page_partials.empty?%>
		<%= f.fields_for :page_partials do |ppf| %>
			<%= ppf.select :child_page_id, Page.partials.collect{|p| [p.title, p.id]}%>
			<%= ppf.link_to_remove "Remove this Partial" %>
		<% end %>
		<p><%= f.link_to_add "Add a Partial", :page_partials %></p>
	</div>
	<div class="field">
    <%= f.label :is_footer %>
    <%= f.check_box :is_footer %>
  </div>
	<div class='field'>
		<%= f.label :page_footers %>
		<%# @page.page_footers.build if @page.page_footers.empty?%>
		<%= f.fields_for :page_footers do |ppf| %>
			<%= ppf.select :footer_id, Page.footers.collect{|p| [p.title, p.id]}%>
			<%= ppf.link_to_remove "Remove this Footer" %>
		<% end %>
		<p><%= f.link_to_add "Add a Footer", :page_footers %></p>
	</div>

  <%= render :partial => "form_advanced_options",
             :locals => {
                :f => f
              } %>

  <%= render :partial => "/shared/admin/form_actions",
             :locals => {
               :f => f,
               :continue_editing => true,
               :delete_title => t('delete', :scope => 'admin.pages'),
               :delete_confirmation => t('message', :scope => 'shared.admin.delete', :title => @page.title)
             } %>

  <%= render :partial => "form_new_page_parts",
             :locals => {
               :f => f
             } if RefinerySetting.find_or_set(:new_page_parts, false) %>
<% end %>

<% content_for :javascripts do %>
  <script>
    $(document).ready(function(){
      page_options.init(
        <%= RefinerySetting.find_or_set(:new_page_parts, false).to_s %>
        , "<%= new_admin_page_part_path %>"
        , "<%= admin_page_parts_path %>"
      );
    });
  </script>
<% end %>
